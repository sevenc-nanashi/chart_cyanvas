import{j as e,r as d}from"./context-vN2-4QuS.js";import{c as m}from"./clsx-B-dksMZM.js";import{p as j,C as f,L as R,M,d as S,E as w,H as T,N as O,e as A,O as E}from"./chunk-2-DY34j8pW.js";import{C as F,O as L}from"./ChartCard-Djra4y7v.js";import{u as h}from"./useTranslation-CesOUbzQ.js";import{C as I,I as _,T as q,A as D,a as P}from"./TextInput-UD9WoQpX.js";import{M as H}from"./ModalPortal-DIql0Uge.js";import{c as W,u as J}from"./contexts-CgsfAxcF.js";import{i as U,a as N,g as z}from"./utils-lR0QA9I9.js";import{w as B,x as G,q as K,L as x}from"./components-NKq783Lw.js";import{T as v}from"./chunk-4-CoigCJVH.js";const Q=({sections:t})=>{const{t:s}=h("chartSection");return e.jsx(e.Fragment,{children:t.map((n,r)=>e.jsxs("div",{className:"flex flex-col mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold",children:n.title}),e.jsx("div",{className:"overflow-x-scroll",children:e.jsx("div",{className:"flex flex-nowrap flex-shrink min-h-[208px] mt-4 gap-4 relative min-w-max",children:n.items.length>0?n.items.map(i=>e.jsx(F,{data:i},i.name)):e.jsx("p",{className:"text-lg",children:s("notFound")})})})]},r))})},oe={i18n:"chart"},ie=({data:t})=>{var n;const s=t.chartData;return[{title:t.title},{name:"og:type",content:"article"},{name:"og:article:published_time",content:s.publishedAt},{name:"og:article:modified_time",content:s.updatedAt},{name:"og:site_name",content:`Chart Cyanvas - ${s.authorName||s.author.name}#${s.author.handle}`},{name:"og:description",content:s.description},{name:"og:title",content:`${s.title} - ${s.composer}${s.artist?` / ${s.artist}`:""} (Lv. ${s.rating}, ♡${s.likes})`},{name:"og:url",content:`${t.host}/charts/${s.name}`},{name:"og:image",content:(n=s.cover)!=null&&n.startsWith("/")?`${t.host}${s.cover}`:s.cover}]},ce=()=>{const{chartData:t}=B(),{name:s}=G();if(!s)throw new Error("chartName is required");const{t:n}=h(),{t:r}=h("chart"),i=K(),b=W(),l=J(),[k,p]=d.useState(!1),[c,y]=d.useState(!1),C=d.useCallback(async()=>{l!=null&&l.loggedIn&&l.user.userType==="admin"?(await fetch("/api/admin/delete-chart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s,warn:c,reason:document.querySelector("[data-name=warnReason]").value})}),i(j("/users/:handle",{handle:t.author.handle}))):(await fetch(j("/api/charts/:name",{name:s}),{method:"DELETE"}),i("/charts/my"))},[s,i,l,c,t]),$=U(l,t)||(l==null?void 0:l.loggedIn)&&l.user.userType==="admin",u=N(l)?n("adminDecorate"):"";return t.description.split(/\n/g).length>3?`${t.description.split(/\n/g).splice(0,3).join(`
`).substring(0,100)}`:t.description,e.jsxs(e.Fragment,{children:[e.jsxs(H,{isOpen:k,children:[e.jsx("h1",{className:"text-xl font-bold text-normal mb-2 break-word",children:r("deletionModal.title")}),N(l)?e.jsxs(e.Fragment,{children:[e.jsx(I,{label:r("deletionModal.warnAuthor"),checked:c,onChange:o=>y(o.target.checked)}),e.jsx(_,{text:r("deletionModal.warnReason"),children:e.jsx(q,{name:"warnReason",textarea:!0,optional:!0,className:"w-full h-32",disabled:!c})})]}):e.jsx("p",{className:"text-sm text-gray-500 text-normal mb-1",children:r("deletionModal.description")}),e.jsxs("div",{className:"flex justify-end mt-4 gap-2",children:[e.jsx("div",{className:"px-4 py-2 rounded text-sm border-2 border-slate-500 dark:border-white text-normal cursor-pointer",onClick:()=>{p(!1)},children:n("cancel")}),e.jsx("div",{className:m("px-4 py-2 rounded text-sm bg-red-500 text-white cursor-pointer"),onClick:()=>{C()},children:r("deletionModal.ok")})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"min-h-[300px] w-full flex relative",children:[e.jsxs("div",{className:"flex flex-col flex-grow max-w-[calc(100%_-_128px)]",children:[t.variantOf&&e.jsx("h4",{className:"text-gray-500",children:e.jsxs(x,{to:`/charts/${t.variantOf.name}`,children:[e.jsx(D,{}),t.variantOf.title," "]})}),e.jsxs("h1",{className:m("text-4xl font-bold break-words",!!t.data||"text-yellow-700"),children:[t.title,t.visibility==="scheduled"&&e.jsx("span",{className:"ml-2 text-slate-900 dark:text-white",children:e.jsx(f,{})}),t.visibility==="private"&&e.jsx("span",{className:"ml-2 text-slate-900 dark:text-white",children:e.jsx(R,{})}),!!t.data||e.jsx("span",{className:"ml-2 text-yellow-700",children:e.jsx(f,{})})]}),e.jsxs("p",{className:"text-lg mt-4",children:[e.jsx(M,{className:"mr-1 h-6 w-6"}),t.composer]}),e.jsxs("p",{className:"text-lg",children:[e.jsx(S,{className:"mr-1 h-6 w-6"}),t.artist||"-"]}),e.jsx("p",{className:"text-lg",children:t.tags.length>0?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"mr-1 w-6 h-6"}),t.tags.join("、")]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"mr-1 w-6 h-6 text-slate-400 dark:text-slate-500"}),"-"]})}),e.jsx("p",{className:"text-lg",children:e.jsxs(x,{to:`/users/${t.author.handle}`,children:[e.jsx(w,{className:"mr-1 h-6 w-6"}),t.authorName||t.author.name,e.jsxs("span",{className:"text-xs",children:["#",t.author.handle]})]})}),e.jsxs("p",{className:"text-lg text-red-400",children:[e.jsx(T,{className:"mr-1 h-6 w-6"}),t.likes]}),e.jsxs("p",{className:"text-gray-500 font-monospace text-sm",children:[e.jsx(O,{className:"mr-1 h-4 w-4"}),s]}),e.jsx("p",{className:"flex-grow mt-4 whitespace-pre-wrap",children:t.description})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"md:h-40 md:w-40 rounded-xl square w-32 h-32 relative",children:[e.jsx(L,{src:t==null?void 0:t.cover,alt:t==null?void 0:t.title,className:"md:h-40 md:w-40 h-32 w-32 rounded-xl",width:160,height:160}),t&&e.jsxs("div",{className:`absolute text-xs top-0 left-0 p-1 px-2 rounded-br-xl rounded-tl-[10px] font-bold text-white ${z(t.rating)}`,children:["Lv. ",t.rating]})]}),e.jsx("div",{className:"flex flex-col w-32 md:w-40 mt-4 text-center gap-2",children:[o=>e.jsxs(e.Fragment,{children:[d.createElement(o.icon,{className:"h-5 w-5 mr-1"}),o.text]})].map(o=>[$&&[{href:`/charts/${s}/edit`,icon:w,className:"bg-theme text-white",text:r("edit")+u},{text:r("delete")+u,icon:A,className:"bg-red-500 text-white",onClick:()=>{p(!0)}}],t.chart&&[{href:`/api/charts/${s}/download_chart`,icon:P,className:"bg-theme text-white",text:r("download")}],{text:n("openInSonolus"),icon:E,className:"bg-black text-white",href:`https://open.sonolus.com/${b.host}/levels/chcy-${t.name}`}].flat().flatMap(a=>a?[a]:[]).map((a,g)=>a.href?e.jsx(x,{to:a.href,className:m("text-center p-1 rounded focus:bg-opacity-75 hover:bg-opacity-75 transition-colors duration-200",a.className),onClick:"onClick"in a?a.onClick:void 0,children:o(a)},g):e.jsx("div",{className:m("text-center p-1 rounded focus:bg-opacity-75 hover:bg-opacity-75 transition-colors duration-200 cursor-pointer",a.className),onClick:"onClick"in a?a.onClick:void 0,children:o(a)},g)))})]})]}),e.jsx(Q,{sections:[{title:r("variants"),items:(t==null?void 0:t.variants)||null,hasMore:!1}]},t==null?void 0:t.name)]})]})};export{ce as default,oe as handle,ie as meta};

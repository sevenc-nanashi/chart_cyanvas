import{r as e,j as t}from"./context-vN2-4QuS.js";import{c as x}from"./clsx-B-dksMZM.js";import{c as k,D as E,a as w,H as b,b as M,p as j}from"./chunk-2-DY34j8pW.js";import{u as g,S as y,a as C,b as P}from"./contexts-CgsfAxcF.js";import{i as N}from"./i18next-cOPaZ5Oq.js";import{u as p}from"./useTranslation-CesOUbzQ.js";import{l as H,n as S,o as z,p as L,_,q as R,L as v,O as V,t as I,M as W,v as T,S as D}from"./components-NKq783Lw.js";import{T as O}from"./chunk-4-CoigCJVH.js";import{M as U}from"./ModalPortal-DIql0Uge.js";import{T as Z}from"./Trans-COWa_CB2.js";/**
 * @remix-run/react v2.11.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */let f="positions";function $({getKey:n,...l}){let{isSpaMode:a}=H(),o=S(),r=z();L({getKey:n,storageKey:f});let i=e.useMemo(()=>{if(!n)return null;let c=n(o,r);return c!==o.key?c:null},[]);if(a)return null;let h=((c,m)=>{if(!window.history.state||!window.history.state.key){let d=Math.random().toString(32).slice(2);window.history.replaceState({key:d},"")}try{let u=JSON.parse(sessionStorage.getItem(c)||"{}")[m||window.history.state.key];typeof u=="number"&&window.scrollTo(0,u)}catch(d){console.error(d),sessionStorage.removeItem(c)}}).toString();return e.createElement("script",_({},l,{suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:`(${h})(${JSON.stringify(f)}, ${JSON.stringify(i)})`}}))}const F="/assets/favicon-DKZk3_V7.svg",q=()=>t.jsx(t.Fragment,{children:t.jsxs("footer",{className:x("bg-slate-300 dark:bg-slate-600 flex items-center h-20 align-center justify-center text-white dark:text-slate-300 text-sm","flex flex-col md:gap-2","[&_a]text-blue-500 [&_a]dark:text-theme"),children:[t.jsxs("div",{className:"flex flex-col md:flex-row md:gap-2 items-center",children:[t.jsx("div",{children:"Chart Cyanvas - A sekai custom chart platform."}),t.jsxs("div",{children:["Â© 2022-2024,"," ",t.jsx("a",{target:"_blank",rel:"noreferrer",href:"https://sevenc7c.com",children:"Nanashi. <sevenc-nanashi>"})]})]}),t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/sevenc-nanashi/chart_cyanvas",children:"GitHub"})," ","|",t.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:"https://discord.gg/2NP3U3r8Rz",children:"Discord"})," ","|",t.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:"https://www.patreon.com/sevenc_nanashi",children:"Patreon"})]})]})}),A=n=>e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",xmlSpace:"preserve",width:512,height:512,...n},e.createElement("defs",null,e.createElement("path",{id:"a",d:"M1 0h256v512H1z"})),e.createElement("clipPath",{id:"b"},e.createElement("use",{xlinkHref:"#a",overflow:"visible"})),e.createElement("g",{clipPath:"url(#b)"},e.createElement("defs",null,e.createElement("path",{id:"c",d:"M429 120H103v178h326zM1 0h265v512H1z"}))),e.createElement("defs",null,e.createElement("path",{id:"d",d:"M1 0h256v512H1z"})),e.createElement("clipPath",{id:"e"},e.createElement("use",{xlinkHref:"#d",overflow:"visible"})),e.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeMiterlimit:10,strokeWidth:20,d:"M116 404h140",clipPath:"url(#e)"}),e.createElement("g",{clipPath:"url(#e)"},e.createElement("defs",null,e.createElement("path",{id:"f",d:"M429 120H103v178h326zM1 0h265v512H1z"})),e.createElement("clipPath",{id:"g"},e.createElement("use",{xlinkHref:"#f",overflow:"visible"})),e.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeMiterlimit:10,strokeWidth:30,d:"M96.271 476 209.75 73",clipPath:"url(#g)"}),e.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeMiterlimit:10,strokeWidth:20,d:"M256 404V46",clipPath:"url(#g)"})),e.createElement("path",{fill:"none",stroke:"currentColor",strokeMiterlimit:10,strokeWidth:15,d:"M139.5 126v180",clipPath:"url(#e)"}),e.createElement("g",{clipPath:"url(#e)"},e.createElement("path",{fill:"currentColor",d:"M116.271 109.297h311.71c11 0 20 9 20 20V301.9c0 11-9 20-20 20h-311.71c-11 0-20-9-20-20V129.297c0-11 9-20 20-20M116.4 298h298.8v-1.674c7.456-2.913 12.781-10.168 12.781-18.623V149.297c0-8.455-5.325-15.71-12.781-18.623V129H116.4z"})),e.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeMiterlimit:10,strokeWidth:24,d:"M256 311H86",clipPath:"url(#e)"}),e.createElement("defs",null,e.createElement("path",{id:"h",d:"M1 0h256v512H1z"})),e.createElement("clipPath",{id:"i"},e.createElement("use",{xlinkHref:"#h",overflow:"visible"})),e.createElement("g",{clipPath:"url(#i)"},e.createElement("defs",null,e.createElement("path",{id:"j",d:"M429 120H103v178h326zM1 0h265v512H1z"}))),e.createElement("defs",null,e.createElement("path",{id:"k",d:"M255 0h256v512H255z"})),e.createElement("clipPath",{id:"l"},e.createElement("use",{xlinkHref:"#k",overflow:"visible"})),e.createElement("g",{clipPath:"url(#l)"},e.createElement("defs",null,e.createElement("path",{id:"m",d:"M83 120h326v178H83zM511 0H246v512h265z"}))),e.createElement("defs",null,e.createElement("path",{id:"n",d:"M255 0h256v512H255z"})),e.createElement("clipPath",{id:"o"},e.createElement("use",{xlinkHref:"#n",overflow:"visible"})),e.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeMiterlimit:10,strokeWidth:20,d:"M396 404H256",clipPath:"url(#o)"}),e.createElement("g",{clipPath:"url(#o)"},e.createElement("defs",null,e.createElement("path",{id:"p",d:"M83 120h326v178H83zM511 0H246v512h265z"})),e.createElement("clipPath",{id:"q"},e.createElement("use",{xlinkHref:"#p",overflow:"visible"})),e.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeMiterlimit:10,strokeWidth:30,d:"M415.729 476 302.25 73",clipPath:"url(#q)"}),e.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeMiterlimit:10,strokeWidth:20,d:"M256 404V46",clipPath:"url(#q)"})),e.createElement("path",{fill:"none",stroke:"currentColor",strokeMiterlimit:10,strokeWidth:15,d:"M372.5 126v180",clipPath:"url(#o)"}),e.createElement("g",{clipPath:"url(#o)"},e.createElement("path",{fill:"currentColor",d:"M395.729 109.297H84.019c-11 0-20 9-20 20V301.9c0 11 9 20 20 20h311.71c11 0 20-9 20-20V129.297c0-11-9-20-20-20M395.6 298H96.8v-1.674c-7.456-2.913-12.781-10.168-12.781-18.623V149.297c0-8.455 5.326-15.71 12.781-18.623V129h298.8z"})),e.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeMiterlimit:10,strokeWidth:24,d:"M256 311h170",clipPath:"url(#o)"}),e.createElement("defs",null,e.createElement("path",{id:"r",d:"M255 0h256v512H255z"})),e.createElement("clipPath",{id:"s"},e.createElement("use",{xlinkHref:"#r",overflow:"visible"})),e.createElement("g",{clipPath:"url(#s)"},e.createElement("defs",null,e.createElement("path",{id:"t",d:"M83 120h326v178H83zM511 0H246v512h265z"}))),e.createElement("defs",null,e.createElement("path",{id:"u",d:"M115 129h280v169H115z"})),e.createElement("clipPath",{id:"v"},e.createElement("use",{xlinkHref:"#u",overflow:"visible"})),e.createElement("path",{fill:"currentColor",d:"m359.818 330.229-50.318-.774L239.603 359h55.13zM361.677 215h-53.161s-86.633 8.203-86.633 27.681S308.516 272 308.516 272h53.161s-88.488-9.09-88.603-28.91c-.115-19.896 88.603-28.09 88.603-28.09M151 156h53.162s86.633 8.203 86.633 27.681S204.162 213 204.162 213H151s88.489-9.09 88.603-28.91C239.718 164.195 151 156 151 156",clipPath:"url(#v)",opacity:.75}),e.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:10,strokeWidth:9,d:"m350.356 318.257-13.29-7.784-13.292 7.784M351.148 201.434l-9.291-11.099-15.685 3.532M162.514 140.795l9.29-11.099 15.687 3.532",clipPath:"url(#v)"}),e.createElement("g",{clipPath:"url(#v)"},e.createElement("path",{fill:"currentColor",d:"M361 390a5 5 0 0 1-5 5h-42a5 5 0 0 1-5-5v-5a5 5 0 0 1 5-5h42a5 5 0 0 1 5 5z"})),e.createElement("g",{clipPath:"url(#v)"},e.createElement("path",{fill:"currentColor",d:"M206 390a5 5 0 0 1-5 5h-45a5 5 0 0 1-5-5v-5a5 5 0 0 1 5-5h45a5 5 0 0 1 5 5z"})),e.createElement("g",{clipPath:"url(#v)"},e.createElement("path",{fill:"currentColor",d:"M206 347a5 5 0 0 1-5 5h-45a5 5 0 0 1-5-5v-5a5 5 0 0 1 5-5h45a5 5 0 0 1 5 5z"})),e.createElement("g",{clipPath:"url(#v)"},e.createElement("path",{fill:"currentColor",d:"M206 303a5 5 0 0 1-5 5h-45a5 5 0 0 1-5-5v-5a5 5 0 0 1 5-5h45a5 5 0 0 1 5 5z"})),e.createElement("g",{clipPath:"url(#v)"},e.createElement("path",{fill:"currentColor",d:"M223 275a5 5 0 0 1-5 5h-62a5 5 0 0 1-5-5v-5a5 5 0 0 1 5-5h62a5 5 0 0 1 5 5z"})),e.createElement("g",{clipPath:"url(#v)"},e.createElement("path",{fill:"currentColor",d:"M363 156a5 5 0 0 1-5 5h-59a5 5 0 0 1-5-5v-5a5 5 0 0 1 5-5h59a5 5 0 0 1 5 5z"})),e.createElement("g",{clipPath:"url(#v)"},e.createElement("path",{fill:"currentColor",d:"M295 362a5 5 0 0 1-5 5h-45a5 5 0 0 1-5-5v-5a5 5 0 0 1 5-5h45a5 5 0 0 1 5 5z"})),e.createElement("g",{clipPath:"url(#v)"},e.createElement("path",{fill:"currentColor",d:"M361 333a5 5 0 0 1-5 5h-42a5 5 0 0 1-5-5v-5a5 5 0 0 1 5-5h42a5 5 0 0 1 5 5z"})),e.createElement("g",{clipPath:"url(#v)"},e.createElement("path",{fill:"currentColor",d:"M361 275a5 5 0 0 1-5 5h-42a5 5 0 0 1-5-5v-5a5 5 0 0 1 5-5h42a5 5 0 0 1 5 5z"})),e.createElement("g",{clipPath:"url(#v)"},e.createElement("path",{fill:"currentColor",d:"M206 216a5 5 0 0 1-5 5h-45a5 5 0 0 1-5-5v-5a5 5 0 0 1 5-5h45a5 5 0 0 1 5 5z"})),e.createElement("g",{clipPath:"url(#v)"},e.createElement("path",{fill:"currentColor",d:"M207 156a5 5 0 0 1-5 5h-45a5 5 0 0 1-5-5v-5a5 5 0 0 1 5-5h45a5 5 0 0 1 5 5z"})),e.createElement("g",{clipPath:"url(#v)"},e.createElement("path",{fill:"currentColor",d:"M361 216a5 5 0 0 1-5 5h-42a5 5 0 0 1-5-5v-5a5 5 0 0 1 5-5h42a5 5 0 0 1 5 5z"}))),G=k("SignOutRegular","1em",["M8.5 11.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM11 3.5a.5.5 0 0 0-.58-.5l-7 1.08a.5.5 0 0 0-.42.49v10.86c0 .25.18.46.42.5l7 1.07a.5.5 0 0 0 .58-.5V10h5.17l-1 .87a.5.5 0 0 0 .66.76l2-1.75a.5.5 0 0 0 0-.76l-2-1.75a.5.5 0 1 0-.65.76l1 .87H11V3.5Zm-1 .58v11.84L4 15V5l6-.92ZM12.5 16H12v-5h1v4.5a.5.5 0 0 1-.5.5ZM12 8V4h.5c.28 0 .5.22.5.5V8h-1Z"]),J=({close:n})=>{const l=g(),{t:a}=p("menu"),o=R();return!l||!l.loggedIn?null:t.jsx("div",{className:"top-0 left-0 right-0 h-[100lvh] fixed bg-slate-900 dark:bg-black bg-opacity-20 dark:bg-opacity-40 z-50",onClick:n,children:t.jsxs("div",{className:"absolute right-2 top-2 min-w-64 h-[calc(100svh_-_16px)] bg-white dark:bg-slate-900 shadow-lg rounded-lg p-4 flex flex-col",onClick:r=>r.stopPropagation(),children:[t.jsx(v,{to:`/users/${l.user.handle}`,onClick:n,children:t.jsxs("div",{className:"flex items-center bg-theme p-2 bg-opacity-0 hover:bg-opacity-10 transition-colors duration-250 rounded cursor-pointer",children:[t.jsx("div",{className:"rounded-full w-10 h-10 mr-2",style:{backgroundColor:l.user.bgColor}}),t.jsxs("div",{className:"font-bold text-2xl text-normal",children:[l.user.name,t.jsxs("span",{className:"text-sm",children:["#",l.user.handle]})]})]})}),t.jsx("div",{className:"w-full h-[1px] my-2 bg-slate-200 dark:bg-slate-700"}),t.jsx("div",{className:"flex flex-col flex-grow",children:[{type:"button",text:a("post"),icon:E,href:"/charts/upload"},{type:"line"},{type:"button",text:a("my"),icon:w,href:"/charts/my"},{type:"button",text:a("liked"),icon:b,href:"/charts/liked"},{type:"line"},{type:"button",text:a("myAlts"),icon:O,href:"/users/alts"},{type:"space"},{type:"button",text:a("guideline"),icon:M,href:`https://cc-wiki.sevenc7c.com/${N.language}/guideline`},{type:"line"},{type:"button",icon:G,text:a("logout"),className:"text-red-400",onClick:()=>{fetch("/api/login/session",{method:"delete"}).then(()=>{window.location.href="/"})}}].map((r,i)=>{switch(r.type){case"line":return t.jsx("div",{className:"w-full h-[1px] my-2 bg-slate-100 dark:bg-slate-800"},i);case"space":return t.jsx("div",{className:"min-h-4 flex-grow"},i);case"button":return t.jsxs("div",{className:x("flex items-center bg-theme p-2 bg-opacity-0 hover:bg-opacity-10 transition-colors duration-250 rounded cursor-pointer",r.className),onClick:()=>{var h;r.href?r.href.startsWith("http")?window.open(r.href,"_blank"):o(r.href):(h=r.onClick)==null||h.call(r),n()},role:"button",children:[r.icon&&t.jsx("div",{className:"mr-2 h-6 w-6",children:e.createElement(r.icon,{className:"h-full w-full"})}),t.jsx("div",{className:"text-lg",children:r.text})]},i);default:throw new Error(`Unknown item type: ${r.type}`)}})})]})})},B=()=>{var u;const{t:n}=p("header"),l=g(),[a,o]=e.useState(!1),[r,i]=e.useState(),h=e.useRef();e.useEffect(()=>{r&&(h.current=r.uuid)},[r]);const c=e.useRef(),m=e.useCallback(()=>{fetch(j("/api/login/status",{uuid:h.current}),{method:"GET"}).then(s=>s.json()).then(s=>{s.code==="ok"&&window.location.reload()})},[]),d=e.useCallback(()=>{fetch("/api/login/start",{method:"POST"}).then(s=>s.json()).then(s=>{i({uuid:s.uuid,url:new URL(s.url)}),c.current=setInterval(m,2500),window.open(s.url,"_blank")})},[m]);return t.jsxs(t.Fragment,{children:[t.jsxs(U,{isOpen:!!r,close:()=>{i(void 0),clearInterval(c.current)},children:[t.jsx("h1",{className:"text-xl font-bold mb-2",children:n("login.title")}),t.jsx("p",{className:"whitespace-pre-wrap",children:t.jsx(Z,{ns:"header",i18nKey:"login.description",components:[t.jsx("a",{href:((u=r==null?void 0:r.url)==null?void 0:u.toString())||"",target:"_blank"},0)]})})]}),t.jsxs("header",{className:"bg-theme dark:bg-gray-800 flex items-center pl-4 pr-8 h-20 shadow-sm shadow-[#83ccd288]",children:[t.jsxs(v,{to:"/",className:"flex items-center",children:[t.jsx(A,{className:"text-white dark:text-theme",width:"56px",height:"56px",viewBox:"0 0 512 512"}),t.jsxs("span",{className:"text-2xl md:text-4xl text-white dark:text-theme font-extrabold",children:["Chart",t.jsx("br",{className:"block md:hidden"}),t.jsx("span",{className:"hidden md:inline",children:" "}),"Cyanvas",!1]})]}),t.jsx("div",{className:"flex-grow"}),l!==void 0?l.loggedIn?t.jsxs("div",{className:"flex items-end text-white bg-white p-2 bg-opacity-0 hover:bg-opacity-10 transition-colors duration-250 rounded cursor-pointer",onClick:()=>o(!0),children:[t.jsx("div",{className:"rounded-full w-8 h-8 md:mr-2",style:{backgroundColor:l.user.bgColor}}),t.jsxs("div",{className:"font-bold text-xl text-white md:block hidden",children:[l.user.name,t.jsxs("span",{className:"text-sm",children:["#",l.user.handle]})]})]}):t.jsx("button",{className:"p-2 px-4 rounded font-bold bg-white dark:bg-theme text-theme dark:text-slate-900 ml-2",onClick:d,children:n("login.button")}):t.jsx("div",{className:"p-4 w-32 rounded font-bold bg-slate-100 dark:bg-theme text-theme dark:text-slate-900 animate-pulse"})]}),a&&l&&l.loggedIn&&t.jsx(J,{close:()=>o(!1)})]})},K="/assets/globals-DnFN426a.css",oe=()=>[{rel:"icon",type:"image/svg+xml",href:F},{rel:"stylesheet",href:K}];function ie(){return t.jsx(V,{})}function ce({children:n}){const l=I("root");if(!l)throw new Error("Root loader data not found");const[a,o]=e.useState(void 0),[r,i]=e.useState(),{i18n:h}=p();return e.useEffect(()=>{a&&a.loggedIn!==void 0||fetch("/api/login/session",{method:"GET"}).then(async c=>{const m=await c.json();if(m.code==="ok"){const[d,u]=await Promise.all([fetch("/api/my/alt_users").then(async s=>(await s.json()).users),fetch("/api/my/discord").then(async s=>(await s.json()).discord)]);o({loggedIn:!0,user:m.user,altUsers:d,discord:u})}else o({loggedIn:!1})})},[a]),t.jsxs("html",{lang:h.language,children:[t.jsxs("head",{children:[t.jsx("meta",{charSet:"utf-8"}),t.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),t.jsx("meta",{name:"theme-color",content:"#83ccd2"}),t.jsx(W,{}),t.jsx(T,{})]}),t.jsx("body",{className:"bg-white dark:bg-slate-800 text-normal min-h-screen flex flex-col",children:t.jsx(y.Provider,{value:a,children:t.jsx(C.Provider,{value:i,children:t.jsxs(P.Provider,{value:l.serverSettings,children:[t.jsx(B,{}),t.jsx("main",{className:"py-4 px-4 md:px-40 lg:px-60 max-w-[100vw] flex-grow",children:n}),t.jsx(q,{}),t.jsx($,{}),t.jsx(D,{})]})})})})]})}export{ce as Layout,ie as default,oe as links};
